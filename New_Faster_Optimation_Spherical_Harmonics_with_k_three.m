clear;
clc;
close all;
k=3;
syms x
expr=legendreP(k,x);
difflegendreP_k(x)=diff(expr,x);

% 7 points
a=[0.962110407959442, -.211417294179026, -.172180982375314;-.0917140620969262, .989002178900472, -.11603112059399;.410386993978472, -.725295785362625, -.552746360308321;.57065831715715, .00126270293388618, .821186635675029;.195841697823354, -.0962555385036475, -.97590004647273;.140281073335604,-.592624038592789,.793169571668127;-.840938560236222,.131538146854321,.524900041713751];
%a=[-.962110407959442, -.211417294179026, -.172180982375314;-.0917140620969262, .989002178900472, -.11603112059399; .410386993978472, -.725295785362625, -.552746360308321;.57065831715715, .00126270293388618, .821186635675029;.195841697823354, -.0962555385036475, -.97590004647273;.140281073335604,-.592624038592789,.793169571668127;-.840938560236222,.131538146854321,.524900041713751];
% the best ones
%a=[-0.137701204083156  -0.262293638107704   0.955112781718617;  0.598437211506264  -0.800280579364487  -0.037734575347407; 0.776665535778662   0.595526623664357   0.205277095752488;  -0.000003802811399   0.000001945041091   0.000000754478224; -0.499715799755466   0.547193439977154  -0.671463668950691; 0.963060681595486  -0.200748518673369   0.179483023752350; -0.148891335110593  -0.926312202477150  -0.346088245785547];
% 5 points (I test here. I change the points)
%a=[0.891771735907531   0.238139079376444  -0.384750503574323;-0.167320282089863  -0.801839647240717   0.573634991363732;.410386993978472, -.725295785362625, -.552746360308321;.57065831715715, .00126270293388618, .821186635675029;.195841697823354, -.0962555385036475, -.97590004647273]
%a=[0.891771735907531   0.238139079376444  -0.384750503574323;0.042272750196022   0.775264609414189  -0.630220437611018;.410386993978472, -.725295785362625, -.552746360308321;.57065831715715, .00126270293388618, .821186635675029;.195841697823354, -.0962555385036475, -.97590004647273]
%a=[0.891771735907531   0.238139079376444  -0.384750503574323;0.042272750196022  0.775264609414189  -0.630220437611018;-0.477973070264386  -0.824532129754846  -0.302801107831615;-0.737252284091799   0.007406338594524  -0.675576950258122;-0.124675685423256   0.144807164547916   0.981573664359114]

% another set of 5 points
%a=[-0.9827   -0.1649    0.0838; -0.8703    0.0943    0.4834; -0.3105   -0.4548    0.8347; -0.7391    0.5765   -0.3483; 0.6042    0.7956    0.0444];
%a=[0.8040   -0.5208    0.2870;0.8285    0.3759   -0.4150;-0.0432    0.5419   -0.8393;0.7144    0.3877    0.5825;-0.1593   -0.9864    0.0394]
%a=[-0.7570    0.5819    0.2973;-0.6506   -0.6542   -0.3855;-0.0297   -0.4851    0.8739]
%a=[1,0,0;0,1,0;0,0,1];







G=zeros(2*k+1,2*k+1);
% a=zeros(2*k+1,3);
% while abs(det(G))<.0128
% for i=1:2*k+1
%     theta=(pi)*rand(1);
%     phi=2*pi*rand(1);
%     x=sin(theta)*cos(phi);
%     y=sin(theta)*sin(phi);
%     z=cos(theta);
%     a(i,1)=x;
%     a(i,2)=y;
%     a(i,3)=z;
% %       c(i)=[x;y;z];
% end

%a=[0.9809   -0.3178   -0.0748; 0.4515    0.2612   -0.8532; 0.1881    0.3601    0.9138]

for i=1:2*k+1
    for j=1:2*k+1
        G(i,j)=(2*k+1)*legendreP(k,dot(a(i,:),a(j,:)));
    end
end
% end

T=zeros(1,21);
objectiveFun=0;
for l=1:2*k+1
for j=1:2*k+1
    if (l<j) 
    objectiveFun=objectiveFun+(legendreP(k,dot(a(l,:),a(j,:))))^2;
    end
end
end





T(1)=objectiveFun;

temporary_Object=zeros(1,2*k+1);


temporary_Points=a

for p=1:20

for n=1:2*k+1

w=zeros(1,3);

for j=1:2*k+1
    if ~(j==n)  
    w=w-legendreP(k,dot(a(n,:),a(j,:)))*difflegendreP_k(dot(a(n,:),a(j,:))).*(-a(j,:)+dot(a(n,:),a(j,:)).*a(n,:));
    end
end

w=vpa(w/(norm(w)));

syms t
objectiveFun=0;
for j=1:2*k+1
    for l=1:2*k+1
    if ~(n==j) && ~(n==l) && (l<j)
    objectiveFun=objectiveFun+(legendreP(k,dot(a(l,:),a(j,:))))^2;
    end
    end
    if ~(n==j)
    objectiveFun=objectiveFun+(legendreP(k,dot(cos(t)*a(n,:)+sin(t)*w,a(j,:))))^2;
    end
end

f = @(t) double(subs(objectiveFun, t));


[tmin, fval] = fminbnd(f, 0, 4*pi);

temporary_Object(n)=fval;
temporary_Points(n,:)=cos(tmin)*a(n,:)+sin(tmin)*w;

end


[M,I]=min(temporary_Object);
I

a(I,:)=temporary_Points(I,:);


a


T(p+1)=M

end



plot(T,'DisplayName','Steps of Convergence','LineWidth',3);
legend('Location','northeast','FontSize', 20)
grid on
hold on
plot(T,'*y','DisplayName','')
hold on



Optimal_Points=a

G=zeros(2*k+1,2*k+1);

for i=1:2*k+1
    for j=1:2*k+1
        G(i,j)=(2*k+1)*legendreP(k,dot(a(i,:),a(j,:)));
    end
end

G

A=G^(-1/2)


